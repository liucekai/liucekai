<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-06-03T02:26:56.031Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>CeKai</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>1000人冗余型企业网</title>
    <link href="http://yoursite.com/2020/06/02/1000%E4%BA%BA%E5%86%97%E4%BD%99%E5%9E%8B%E4%BC%81%E4%B8%9A%E7%BD%91/"/>
    <id>http://yoursite.com/2020/06/02/1000%E4%BA%BA%E5%86%97%E4%BD%99%E5%9E%8B%E4%BC%81%E4%B8%9A%E7%BD%91/</id>
    <published>2020-06-02T12:30:00.000Z</published>
    <updated>2020-06-03T02:26:56.031Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><ul><li>确保分支可以访问总部</li><li>企业内网划分多个vlan</li><li>出口配置NAT</li><li>禁止vlan5访问外网</li><li>所有设备，在任何位置都能telnet远程管理</li><li>设置合理的stp优先级、边缘端口、使用stp优化技术加快stp收敛、并减少stp震荡</li><li>所有用户均为自动获取ip地址，并配置相关dhcp安全技术</li><li>一定程度上实现负载均衡\分担、链路冗余</li><li>在企业出口将内网服务器的端口映射到电信公网，允许外网用户访问</li></ul><h2 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h2><ul><li>减少广播域大小，提高网络稳定性</li><li>减少设备收敛时间、将stp优化</li><li>提高内网设备安全性</li><li>acl合理控制</li><li>设备尽量实现负载均衡\分担、链路冗余详细方案</li></ul><h2 id="详细方案"><a href="#详细方案" class="headerlink" title="详细方案"></a>详细方案</h2><h3 id="步骤一：底层eth-trunk-、vlan（含修剪）、trunk"><a href="#步骤一：底层eth-trunk-、vlan（含修剪）、trunk" class="headerlink" title="步骤一：底层eth-trunk 、vlan（含修剪）、trunk"></a>步骤一：底层eth-trunk 、vlan（含修剪）、trunk</h3><p><strong>eth-trunk配置：</strong></p><p><strong>SW1</strong></p><p><code>Int eth-trunk 2</code></p><p><code>mode lacp-static</code></p><p><code>trunkport g0/0/2</code></p><p><code>trunkport g0/0/3</code></p><p><strong>SW2</strong></p><p><code>Int eth-trunk 2</code></p><p><code>mode lacp-static</code></p><p><code>trunkport g0/0/2</code></p><p><code>trunkport g0/0/1</code></p><p><strong>SW3</strong></p><p><code>Int eth-trunk 1</code></p><p><code>mode lacp-static</code></p><p><code>trunkport e0/0/4</code></p><p><code>trunkport e0/0/5</code></p><p><strong>SW6</strong></p><p><code>Int eth-trunk 1</code></p><p><code>mode lacp-static</code></p><p><code>trunkport e0/0/1</code></p><p><code>trunkport e0/0/3</code></p><p><strong>Vlan、trunk配置（一号楼）</strong></p><p><strong>SW5:</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Ethernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 999</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 2</code></p><p><strong>SW6:</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Eth-Trunk1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 3 999</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 3</code></p><p><strong>SW3:</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Eth-Trunk1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 3 999</code></p><p><code>interface Ethernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 3 999（这里已经隐含vlan修剪，不允许其他vlan的广播报文通过,减小广播域范围）</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 3 999</code></p><p><code>（这里已经隐含vlan修剪，不允许其他vlan的广播报文通过）</code></p><p><code>interface Ethernet0/0/3</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 999</code></p><p><strong>vlan、trunk配置（2号楼）</strong></p><p><strong>SW7</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Ethernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 999</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 4</code></p><p><code>interface Ethernet0/0/3</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 5</code></p><p><strong>SW4</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Ethernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 999</code></p><p><code>（这里已经隐含vlan修剪，不允许其他vlan的广播报文通过）</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 999</code></p><p><code>（这里已经隐含vlan修剪，不允许其他vlan的广播报文通过）</code></p><p><code>interface Ethernet0/0/3</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 99</code></p><p><strong>SW8</strong></p><p><code>vlan batch 2 to 5 200 999</code></p><p><code>interface Ethernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 200 999</code></p><p><code>interface Ethernet0/0/2</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 200 999</code></p><p><code>interface Ethernet0/0/3</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 200</code></p><p><code>interface Ethernet0/0/4</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 200</code></p><p><strong>SW1</strong></p><p><code>vlan batch 2 to 5 200 800 999</code>（vlan 800是用于access口的，vlan只能从属一个access口）</p><p><code>interface Eth-Trunk2</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 5 200 999</code></p><p> <code>mode lacp-static</code></p><p><code>interface GigabitEthernet0/0/1</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 3 999</code></p><p><code>interface GigabitEthernet0/0/4</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 999</code></p><p><code>interface GigabitEthernet0/0/5</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 200 999</code></p><p><code>interface GigabitEthernet0/0/6</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 800</code></p><p><strong>SW2</strong></p><p>Vlan batch 2 to 5 200 801 999（vlan 800是用于access口的，vlan只能从属一个access口，所以这里创建801）</p><p><code>interface Eth-Trunk2</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 5 200 999</code></p><p> <code>mode lacp-static</code></p><p><code>interface GigabitEthernet0/0/3</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 200 999</code></p><p><code>interface GigabitEthernet0/0/4</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 4 to 5 999</code></p><p><code>interface GigabitEthernet0/0/5</code></p><p> <code>port link-type trunk</code></p><p> <code>port trunk allow-pass vlan 2 to 3 999</code></p><p><code>interface GigabitEthernet0/0/6</code></p><p> <code>port link-type access</code></p><p> <code>port default vlan 801</code></p><h3 id="步骤二：MSTP（二层冗余）"><a href="#步骤二：MSTP（二层冗余）" class="headerlink" title="步骤二：MSTP（二层冗余）"></a>步骤二：MSTP（二层冗余）</h3><p>（MSTP存在的必要性：因为存在设备冗余，出现环路，为了使流量稳定发送并且实现负载分担，需要通过MSTP来做到，以提供二层冗余，STP做不到，STP只能阻塞一个口，MSTP可以通过多个实例来阻塞不同的口，以达到负载均衡的效果）</p><p><strong>SW1</strong></p><p><strong>全局模式下</strong></p><p><code>stp region-configuration（启用stp，进入STP配置）</code></p><p> <code>region-name aa（设置MSTP的域名为aa）</code></p><p> <code>revision-level 1（设置MSTP修订版本号为1）</code></p><p> <code>instance 1 vlan 2 to 3 200（将vlan 2 3 200 映射到实例1）</code></p><p> <code>instance 2 vlan 4 to 5（将vlan 4 5映射到实例2）</code></p><p> <code>active region-configuration（激活以上的配置）</code></p><p><strong>由于MSTP关于域和实例的配置要做到所有汇聚、核心及服务组接入交换机的交换机保持一致，所以对SW2 3 4 8刷脚本，略</strong></p><p><strong>设置优先级</strong></p><p><strong>SW1</strong></p><p><strong>全局模式下</strong>   </p><p><img src="https://liucekai.github.io/images/b2-3.png" alt="b2-3"></p><p>stp instance 1 root primary（把SW1设置为实例1的根桥）</p><p>stp instance 2 root secondary（把SW1设置为实例2的备份桥）</p><p><strong>SW2</strong></p><p>stp instance 1 root secondary</p><p>stp instance 2 root primary</p><p>可以实现vlan 2 3 200的流量从sw1往上走</p><p>Vlan 4 5的流量从sw2网上走，一定程度上实现负载分担/负载均衡</p><p>检查</p><p>发现sw3中确实是在实例1里阻塞了2口，达到预期效果（没显示实例2是因为该交换机上联口的trunk本就没让vlan 4 5 通过）</p><p><img src="https://liucekai.github.io/images/b2-1.jpg" alt="b2-1"></p><p>SW4也达到预期</p><p><img src="https://liucekai.github.io/images/b2-2.png" alt="b2-2"></p><hr><h3 id="步骤三：VRRP（三层冗余）"><a href="#步骤三：VRRP（三层冗余）" class="headerlink" title="步骤三：VRRP（三层冗余）"></a>步骤三：VRRP（三层冗余）</h3><h3 id="步骤四：BFD（检测引擎假死）"><a href="#步骤四：BFD（检测引擎假死）" class="headerlink" title="步骤四：BFD（检测引擎假死）"></a>步骤四：BFD（检测引擎假死）</h3><h3 id="步骤五：OSPF、NAT"><a href="#步骤五：OSPF、NAT" class="headerlink" title="步骤五：OSPF、NAT"></a>步骤五：OSPF、NAT</h3><h3 id="步骤六：DHCP中继（服务器做地址池）"><a href="#步骤六：DHCP中继（服务器做地址池）" class="headerlink" title="步骤六：DHCP中继（服务器做地址池）"></a>步骤六：DHCP中继（服务器做地址池）</h3><h3 id="步骤七：NAT—Server（服务器端口映射）"><a href="#步骤七：NAT—Server（服务器端口映射）" class="headerlink" title="步骤七：NAT—Server（服务器端口映射）"></a>步骤七：NAT—Server（服务器端口映射）</h3><h3 id="步骤八：ACL访问控制列表"><a href="#步骤八：ACL访问控制列表" class="headerlink" title="步骤八：ACL访问控制列表"></a>步骤八：ACL访问控制列表</h3><h3 id="步骤九：telnet远程管理配置"><a href="#步骤九：telnet远程管理配置" class="headerlink" title="步骤九：telnet远程管理配置"></a>步骤九：telnet远程管理配置</h3><h3 id="步骤十：stp优化相关技术"><a href="#步骤十：stp优化相关技术" class="headerlink" title="步骤十：stp优化相关技术"></a>步骤十：stp优化相关技术</h3><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;需求分析&quot;&gt;&lt;a href=&quot;#需求分析&quot; class=&quot;headerlink&quot; title=&quot;需求分析&quot;&gt;&lt;/a&gt;需求分析&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;确保分支可以访问总部&lt;/li&gt;
&lt;li&gt;企业内网划分多个vlan&lt;/li&gt;
&lt;li&gt;出口配置NAT&lt;/li&gt;
&lt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>园区网</title>
    <link href="http://yoursite.com/2020/06/02/hello-world/"/>
    <id>http://yoursite.com/2020/06/02/hello-world/</id>
    <published>2020-06-02T05:37:36.000Z</published>
    <updated>2020-06-02T12:30:52.699Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>rehat</title>
    <link href="http://yoursite.com/2020/06/02/redhat--linux/"/>
    <id>http://yoursite.com/2020/06/02/redhat--linux/</id>
    <published>2020-06-02T05:37:36.000Z</published>
    <updated>2020-06-02T12:36:21.098Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>我的第一个博客</title>
    <link href="http://yoursite.com/2020/06/02/test-my-site/"/>
    <id>http://yoursite.com/2020/06/02/test-my-site/</id>
    <published>2020-06-02T05:37:36.000Z</published>
    <updated>2020-06-02T12:30:19.445Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
    
  </entry>
  
</feed>
